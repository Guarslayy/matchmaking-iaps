# REST API

Этот документ описывает основные HTTP интерфейсы backend‑сервера. Все ответы возвращаются в формате JSON. Для упрощения авторизации нет: сервис предполагает, что `playerId` хранится на клиенте после создания игрока.

## Форматы данных

**PlayerDTO**

- `id`: число — уникальный идентификатор игрока
- `name`: строка — имя игрока
- `elo`: число — текущий рейтинг ELO
- `gamesPlayed`: число — общее количество сыгранных матчей
- `createdAt`: строка (ISO 8601) — дата/время создания игрока

**MatchDTO**

- `id`: число — идентификатор матча
- `playerId`: число — id текущего игрока (для возвращаемых матчей)
- `opponentId`: число — id соперника
- `result`: строка (`"win"` или `"lose"`)
- `eloBefore`: число — рейтинг игрока до матча
- `eloAfter`: число — рейтинг игрока после матча
- `opponentElo`: число — рейтинг соперника в момент матча
- `color`: строка (`"white"` или `"black"`) — какой цвет фигур был у игрока
- `algorithmUsed`: строка — алгоритм, использованный для подбора пары
- `createdAt`: строка (ISO 8601) — время окончания матча

**MatchResultDTO**

- `match`: объект `MatchDTO` — информация о сыгранном матче
- `player`: объект `PlayerDTO` — обновлённые данные игрока (новый ELO и количество игр)
- `opponent`: объект `PlayerDTO` — данные соперника в момент матча

**MetricsDTO**

- `algorithm`: строка — имя алгоритма (`"baseline"`, `"greedy"`, `"batch_lite"`)
- `avgWaitTime`: число — среднее время ожидания (в секундах)
- `avgRatingDiff`: число — средняя абсолютная разница рейтингов в матчах
- `avgComputeTime`: число — среднее время работы алгоритма (в миллисекундах)

## Endpoints

### Создание игрока

**`POST /players`**

Создаёт нового игрока.

**Тело запроса**

- `name` (string) — имя игрока.

**Ответ**

- `201 Created`, тело: объект `PlayerDTO`.

### Получение профиля игрока

**`GET /players/:id`**

Возвращает информацию о профиле игрока.

**Параметры пути**

- `id` — идентификатор игрока.

**Ответ**

- `200 OK`, тело: объект `PlayerDTO`.

### Получение истории матчей

**`GET /players/:id/history`**

Возвращает список матчей для указанного игрока, отсортированный по времени убывания.

**Параметры пути**

- `id` — идентификатор игрока.

**Ответ**

- `200 OK`, тело: массив `MatchDTO[]`.

### Поиск соперника и запуск матча

**`POST /match/find`**

Запускает процесс матчмейкинга: добавляет игрока в очередь, выбирает соперника согласно алгоритму и симулирует матч (результат определяется случайно).

**Тело запроса**

- `playerId` (number) — идентификатор игрока, который ищет матч.
- `algorithm` (string) — тип алгоритма: `"baseline"`, `"greedy"` или `"batch_lite"`. Если не указан, используется `baseline`.

**Ответ**

- `200 OK`, тело: объект `MatchResultDTO`.
- Если соперник не найден (например, один игрок в очереди), возвращается `202 Accepted` с полем `{ message: "waiting" }`.

### Получение метрик по алгоритму

**`GET /metrics`**

Возвращает усреднённые показатели качества для заданного алгоритма.

**Параметры запроса**

- `algorithm` (string) — обязательный параметр: `baseline`, `greedy` или `batch_lite`.

**Ответ**

- `200 OK`, тело: объект `MetricsDTO`.

### Пример последовательности

1. **Регистрация**: клиент отправляет `POST /players` с телом `{ \"name\": \"Иван\" }` → получает `PlayerDTO` с `id` = 42.
2. **Поиск матча**: клиент отправляет `POST /match/find` с телом `{ \"playerId\": 42, \"algorithm\": \"greedy\" }` → получает `MatchResultDTO`.
3. **Просмотр профиля**: клиент делает `GET /players/42` → видит обновлённый ELO.
4. **Просмотр истории**: клиент делает `GET /players/42/history` → получает список матчей.
